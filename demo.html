<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Yapp Proxy demo using jQuery UI dialog and iframe</title>
    <meta name="Description" content=""/>
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="favicon/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="favicon/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="favicon/manifest.json">
    <link rel="mask-icon" href="favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="favicon/favicon.ico">
    <meta name="msapplication-config" content="favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <!--[if IE]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--
    <link href="css/style.css" rel="stylesheet"/>
    -->
    <style>
.ui-dialog .ui-dialog-content iframe {
    border: none;
    overflow: scroll;
    width: 100%;
    height: calc(100% - 28px);
}
.ui-dialog .ui-dialog-content input {
    display: block;
    width: 100%;
}
.ui-dialog .ui-dialog-content {
    padding: 0 !important;
    margin: 0;
    box-sizing: border-box;
    overflow: hidden !important;
}
.box {
    height: 100%;
    width: 100%;
}
    </style>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js"></script>
    <link href="https://code.jquery.com/ui/1.12.1/themes/dark-hive/jquery-ui.css" rel="stylesheet"/>
    <script>
$(function() {
    var home = 'https://duckduckgo.com/';
    var dialog = $('<div><div class="box"><input/><iframe src="./?__proxy_url='+home+'"></iframe></div></div>').appendTo('body').dialog({
        width: 800,
        height: 600
    });
    var iframe = dialog.find('iframe');
    var input = dialog.find('input').val(home).keypress(function(e) {
        if (e.which == 13) {
            var url = input.val();
            if (!url.match(/^http/)) {
                if (url.match(/^\/\//)) {
                    url = 'http:' + url;
                } else {
                    url = 'http://' + url;
                }
                input.val(url);
            }
            iframe[0].setAttribute('src', './?__proxy_url=base64:' + btoa(url));
            console.log(url);
        }
    });
    window.onmessage = function(e) {
        try {
            var data = JSON.parse(e.data);
            if (data.__proxy) {
                input.val(data.__proxy.url);
                if (data.__proxy.title) {
                    dialog.dialog('option', 'title', data.__proxy.title);
                }
            }
        } catch(e) {}
    };
    
});
    </script>
</head>
<body>
    <a href="https://github.com/jcubic/yapp" style="position: fixed; top: 0; left: 0; z-index:1000"><img style="border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png" alt="Fork Yapp Proxy on GitHub"></a>
</body>
</html>
